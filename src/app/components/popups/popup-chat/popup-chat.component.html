<div class="popup">
  <div class="chat">
    <div class="chat__archive fw-flex">
      <div class="fw-flex-shrink-no">
        <ul class="chat__archive-list">
          <li class="fw-mt-10 active">
            <a (click)="applyFilter()" class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle"
               [ngClass]="{'active': filterParams === {}}">
              <span><i class="icon-chat-messages"></i></span>
              <span><i class="icon-chat-messages-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.ALL' | translate}}</span>
            </a>
          </li>
          <li class="fw-mt-10">
            <a (click)="applyFilter({online: 1})"
               class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle"
               [ngClass]="{'active': !!filterParams['online']}">
              <span><i class="icon-chat-lips"></i></span>
              <span><i class="icon-chat-lips-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.ONLINE' | translate}}</span>
            </a>
          </li>
          <li class="fw-mt-10">
            <a (click)="applyFilter({calls: 1})"
               class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle"
               [ngClass]="{'active': !!filterParams['calls']}">
              <span><i class="icon-chat-phone"></i></span>
              <span><i class="icon-chat-phone-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.CALLS' | translate}}</span>
            </a>
          </li>
          <li class="fw-mt-10">
            <a (click)="applyFilter({removed: 1})"
               class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle"
               [ngClass]="{'active': !!filterParams['removed']}">
              <span><i class="icon-chat-check"></i></span>
              <span><i class="icon-chat-check-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.HIDE_DELETED' | translate}}</span>
            </a>
          </li>
          <li class="fw-mt-10">
            <a (click)="applyFilter({new: 1})"
               class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle"
               [ngClass]="{'active': !!filterParams['new']}">
              <span><i class="icon-chat-bell"></i></span>
              <span><i class="icon-chat-bell-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.NEW' | translate}}</span>
            </a>
          </li>
          <li (click)="applyFilter({favorite: 1})" class="fw-mt-10">
            <a class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle"
               [ngClass]="{'active': !!filterParams['favorite']}">
              <span><i class="icon-chat-star"></i></span>
              <span><i class="icon-chat-star-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.FAVORITES' | translate}}</span>
            </a>
          </li>
          <li (click)="applyFilter({blacklist: 1})" class="fw-mt-10">
            <a [ngClass]="{'active': !!filterParams['blacklist']}"
               class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle">
              <span><i class="icon-chat-hand"></i></span>
              <span><i class="icon-chat-hand-active"></i></span>
              <span class="fw-ml-5">{{'POPUPS.CHAT.FILTERS.BLACKLIST' | translate}}</span>
            </a>
          </li>
        </ul>
      </div>
      <div class="fw-position-relative fw-mt-40 fw-mb-15 fw-flex fw-flex-grow fw-flex-column">
        <p class="fw-fz-15 fw-fw-600 fw-flex-shrink-no">{{'POPUPS.CHAT.FOLDERS.MY_FOLDERS' | translate}}</p>
        <perfect-scrollbar class="fw-flex-grow fw-flex fw-flex-column">
          <ul class="chat__archive-list fw-mt-10" *ngIf="!!folders.length">
            <li class="fw-mt-10" *ngFor="let folder of folders; let i = index;"
                (click)="applyFilter({folderId: folder.id})">
              <a class="fw-link fw-link--blue fw-fz-14 fw-flex fw-flex-middle fw-position-relative fw-text-ellipsis"
                 [ngClass]="{'active': !!filterParams['folderId'] && filterParams['folderId'] === folder.id}">
                <span><i class="icon-chat-folder"></i></span>
                <span><i class="icon-chat-folder-active"></i></span>
                <span class="chat__archive-list--remove" (click)="removeFolder($event, i)"><i
                    class="icon-shape-remove-purple"></i></span>
                <span class="fw-ml-5">{{folder.title}}</span>
              </a>
            </li>
          </ul>
          <div *ngIf="!folders.length" class="fw-mt-10 fw-text-600 fw-color-grey-dark">{{'POPUPS.CHAT.FOLDERS.NO_FOLDERS' | translate}}</div>
        </perfect-scrollbar>
        <app-preloader *ngIf="preloaders.folderList"></app-preloader>
      </div>
      <div class="fw-mt-auto fw-position-relative fw-flex-shrink-no">
        <a *ngIf="!newFolderForm" (click)="newFolderForm = true"
           class="button button--blue button--small fw-width-1-1 fw-flex fw-flex-middle">
          <i class="icon-plus icon-plus--purple-dark fw-mr-5"></i>
          <span class="fw-fz-14 fw-text-600 fw-vam">{{'POPUPS.CHAT.FOLDERS.ADD_FOLDER' | translate}}</span>
        </a>
        <form (submit)="addNewFolder($event)" [formGroup]="FNewFolder" *ngIf="newFolderForm">
          <div class="fw-mb-10">
            <app-input-box formControlName="title" class="fw-width-1-1"
                           [placeholder]="'FORMS.INPUTS.FOLDER_NAME' | translate"></app-input-box>
          </div>
          <div>
            <button class="button button--primary fw-width-1-1">{{'BUTTONS.SAVE' | translate}}</button>
          </div>
        </form>
        <app-preloader *ngIf="preloaders.folderForm"></app-preloader>
      </div>
    </div>
    <div class="chat__messages">
      <div class="chat__header">
        <div><p class="fw-fw-600 fw-fz-16">{{'POPUPS.CHAT.MESSAGES.ALL_MESSAGES' | translate}}</p></div>
        <div><a><i class="icon-chat-search"></i></a></div>
      </div>
      <perfect-scrollbar class="chat__list list" (ps-scroll-y)="infineFolderScroll()">
        <ng-container *ngIf="!!dialogs._embedded">
          <div class="list__item" *ngFor="let dialog of dialogs._embedded.content; let i = index;"
               [ngClass]="{'list__inbox': (dialogKey === i)}"
               (click)="openMessages(i)">
            <div>
              <a class="list__thumbnail">
                <img
                    src="{{ !!dialog.clientTo.avatar ? dialog.clientTo.avatar._links.thumbnail.href : './assets/images/default-navigation-avatar.svg' }}"
                    alt="">
              </a>
            </div>
            <div>
              <div class="list__user" [ngClass]="{'list__user--offline': !dialog.clientTo.online}">
                {{dialog.clientTo.name}}, {{dialog.clientTo.age}}
              </div>
              <p class="list__message"
                 [ngClass]="{'list__message--active': !!dialog.lastMessage, 'list__message--no-massages': !dialog.lastMessage}">
                {{!!dialog.lastMessage ? dialog.lastMessage : 'POPUPS.CHAT.MESSAGES.NO_MESSAGES' | translate}}</p>
              <p class="list__time">{{!!dialog.lastMessageCreated ? dialog.lastMessageCreated :
                ''}}</p>
              <span>
                  <!--<i class="list__icon icon-chat-call-green"></i>-->
                  <i class="list__icon icon-chat-message"></i>
              </span>
            </div>
          </div>
        </ng-container>
      </perfect-scrollbar>
      <app-preloader *ngIf="preloaders.dialogs"></app-preloader>
    </div>
    <div class="chat__content fw-position-relative">
      <app-preloader *ngIf="preloaders.messages"></app-preloader>
      <div class="chat__header chat__header--bordered">
        <div>
          <a><i *ngIf="!!dialog" class="icon-chat-call"></i></a>
        </div>
        <div class="fw-text-center">
          <div class="fw-inline-block">
            <p *ngIf="!!dialog" class="fw-has-user-status fw-text-600"
               [ngClass]="{'fw-has-user-status--offline': !dialog.clientTo.online}">
              {{!!dialog ? dialog.clientTo.name : ''}},
              {{!!dialog ? dialog.clientTo.age : ''}} {{'POPUPS.CHAT.MESSAGES.YEARS' | translate}},
              {{!!dialog ? dialog.clientTo.city.title : ''}}
            </p>
          </div>
          <div><p class="fw-color-grey-dark fw-fz-13" *ngIf="!!dialog">
            {{dialog.clientTo.lastOnline}}</p></div>
        </div>
        <div class="fw-relative fw-flex fw-flex-middle">
          <div class="fw-mr-15 chat__settings-link" *ngIf="!!dialog">
            <i class="icon-chat-cog"></i>
            <i class="icon-chat-cog-active"></i>

            <div class="chat__settings">
              <a class="fw-fz-13" (click)="deleteDialog($event)">{{'POPUPS.CHAT.DIALOGS.DELETE_DIALOG' | translate}}</a>
              <a class="fw-fz-13">{{'POPUPS.CHAT.DIALOGS.MOVE_TO_FOLDER' | translate}}</a>
              <a class="fw-fz-13" (click)="favoriteDialog($event)">
                <span *ngIf="!dialog.favorite">{{'POPUPS.CHAT.DIALOGS.ADD_TO_FAVORITES' | translate}}</span>
                <span *ngIf="dialog.favorite">{{'POPUPS.CHAT.DIALOGS.REMOVE_FROM_FAVORITES' | translate}}</span>
              </a>
              <a class="fw-fz-13" (click)="blacklistDialog($event)">
                <span *ngIf="!dialog.blacklist">{{'POPUPS.CHAT.DIALOGS.ADD_TO_BLACKLIST' | translate}}</span>
                <span *ngIf="dialog.blacklist">{{'POPUPS.CHAT.DIALOGS.REMOVE_FROM_BLACKLIST' | translate}}</span>
              </a>
              <app-preloader *ngIf="preloaders.dialogAction"></app-preloader>
            </div>
          </div>
          <a class="js-close-popup"><i class="icon-chat-close"></i></a>
        </div>
      </div>
      <div class="chat__context context fw-flex">
        <perfect-scrollbar #messagesScroll class="fw-flex-grow fw-flex fw-flex-column">
          <div class="chat__box box" *ngFor="let messageGroup of messages">

            <div class="box__data"><p>{{messageGroup.messageDate}}</p></div>
            <div class="box__message message" [ngClass]="{'message--income': message.incoming}"
                 *ngFor="let message of messageGroup.messageList">
              <div class="message__image" *ngIf="message['incoming']"><img
                  src="http://placehold.it/32x32" alt=""></div>
              <p *ngIf="!message.incoming" class="message__time">{{message['createdTime']}}</p>
              <p class="message__text">
                <span>{{message['message']}}</span>
              </p>
              <p *ngIf="message['incoming']" class="message__time">{{message['createdTime']}}</p>
            </div>
          </div>
        </perfect-scrollbar>
        <div class="context__footer fw-flex-shrink-no fw-pt-15" *ngIf="!!dialog">
          <form [formGroup]="FMessage" class="chat__new-message fw-flex" (submit)="sendMessage($event)">
            <app-input-box formControlName="message" class="fw-flex-grow"
                           [placeholder]="'POPUPS.CHAT.MESSAGES.INPUT_PLACEHOLDER' | translate"></app-input-box>
            <button type="submit" class="fw-reset button--disabled-opacity" [disabled]="FMessage.invalid">
              <i class="icon-chat-send fw-brp-50"></i>
            </button>
          </form>
          <div>
            <div class="chat__new-message-option option">
              <div>
                <a class="option__link">
                  <i class="icon-chat-smile"></i>
                  <i class="icon-chat-smile-active"></i>
                </a>
                <div class="option__sub">
                  <div class="js-scroll-pane">
                    <div class="option__container">
                      <a *ngFor="let item of [1,2,3,4,5]" class="fw-img-square">
                        <img src="http://placehold.it/30x30" alt="">
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <a><i class="icon-chat-photo"></i></a>
              </div>
              <div>
                <a class="option__link">
                  <i class="icon-chat-gift"></i>
                  <i class="icon-chat-gift-active"></i>
                </a>
                <div class="option__sub option__sub--presents">
                  <div class="js-scroll-pane">
                    <div>
                      <p class="fw-fw-600 fw-fz-15 fw-text-center">{{'POPUPS.CHAT.MESSAGES.SPECIAL_PRESENTS' | translate}}</p>
                      <div class="option__container">
                        <a *ngFor="let item of [1,2,3,4,5]" class="fw-img-square">
                          <img src="http://placehold.it/80x80" alt=""></a>
                      </div>
                    </div>
                    <div class="fw-mt-20">
                      <p class="fw-fw-600 fw-fz-15 fw-text-center">{{'POPUPS.CHAT.MESSAGES.VIP_PRESENTS' | translate}}</p>
                      <div class="option__container">
                        <a *ngFor="let item of [1,2,3,4,5]" class="fw-img-square"><img
                            src="http://placehold.it/80x80" alt=""></a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div>
                <p class="fw-fz-13 fw-color-grey">{{'POPUPS.CHAT.MESSAGES.NEW_ROW_INFO' | translate}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
